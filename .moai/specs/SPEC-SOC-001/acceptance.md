# SPEC-SOC-001: 경조사 관리 기능 인수 기준

## 개요

SPEC-SOC-001 경조사 관리 기능의 인수 테스트 시나리오와 완료 정의 기준입니다.

## 인수 테스트 시나리오

### TS-SOC-001: 스크린샷에서 경조사 정보 추출

**Given** 사용자가 결혼식 초대장 스크린샷을 찍었을 때
**When** AI/ML 엔진이 이미지를 분석하면
**Then** 시스템은 다음 정보를 추출해야 한다:
- 이벤트 유형: wedding (결혼식)
- 날짜: 2025년 2월 14일
- 시간: 14:00
- 장소: 그랜드 하얏트 서울
- 관련 인물: 김철수

**추가 Then**:
- 추출 신뢰도가 0.7 이상이어야 한다
- 사용자에게 정보를 카드 형태로 표시해야 한다

---

### TS-SOC-002: 채팅에서 경조사 정보 추출

**Given** 친구가 카카오톡으로 "다음 주 토요일에 우리 강아지 돌잔치 해" 메시지를 보냈을 때
**When** ContextAnalyzerService가 메시지를 분석하면
**Then** 시스템은 다음 정보를 추출해야 한다:
- 이벤트 유형: first_birthday (돌잔치)
- 날짜: 상대적 날짜 계산 (다음 주 토요일)
- 관련 인물: 친구 이름

**추가 Then**:
- 날짜가 명확하지 않으면 사용자에게 확인 요구해야 한다
- 사용자가 날짜를 입력하면 정확한 날짜로 저장해야 한다

---

### TS-SOC-003: 경조사 정보 저장 및 캘린더 등록

**Given** 추출된 경조사 정보를 사용자가 확인하고
**And** 사용자가 "저장" 버튼을 누르면
**When** 시스템이 저장 작업을 실행하면
**Then** 다음이 발생해야 한다:
1. SQLite 데이터베이스에 암호화되어 저장
2. 디바이스 캘린더에 일정 등록
3. 3개 알림 스케줄링 (당일 오전 9시, D-1, D-7)

**추가 Then**:
- 캘린더 일정 제목: "[결혼식] 김철수씨 결혼식"
- 저장 성공 메시지 표시

---

### TS-SOC-004: 경조사 정보 편집

**Given** 저장된 경조사 정보가 있고
**And** 사용자가 정보를 수정하려고 할 때
**When** 사용자가 편집 화면에서 날짜를 변경하고 "저장"을 누르면
**Then** 시스템은 다음을 수행해야 한다:
1. SQLite 데이터베이스 업데이트
2. 캘린더 일정 동기화
3. 알림 스케줄 재설정

**추가 Then**:
- 변경 사항이 즉시 반영되어야 한다

---

### TS-SOC-005: 송금 앱 연동

**Given** 결혼식 경조사 정보가 있고
**And** 사용자가 "송금하기" 버튼을 누르면
**When** 시스템이 송금 앱을 실행하면
**Then** 다음이 발생해야 한다:
1. 관계별 추천 금액 표시 (예: 친구 5만원)
2. 송금 앱 딥링크 실행 (카카오페이, 토스 선택)
3. 송금 완료 후 상태를 "송금 완료"로 변경

**추가 Then**:
- 송금 앱이 설치되지 않으면 스토어 링크 제공

---

### TS-SOC-006: 리마인더 알림

**Given** 경조사 일정이 7일 남았을 때
**When** 시스템이 알림을 발송하면
**Then** 알림 내용은 다음을 포함해야 한다:
- 이벤트 제목: "김철수씨 결혼식"
- 날짜: 2월 14일 금요일
- 장소: 그랜드 하얏트 서울
- 액션 버튼: "지도에서 열기", "송금하기"

**추가 Then**:
- 당일 오전 9시에는 "오늘 일정이 있습니다" 알림 발송

---

### TS-SOC-007: 연락처 연동

**Given** 추출된 인물 이름이 연락처에 존재하고
**And** 사용자가 연락처 접근 권한을 허용했을 때
**When** 시스템이 연락처를 검색하면
**Then** 다음 정보를 자동으로 채워야 한다:
- 프로필 사진
- 전화번호
- 이메일

**추가 Then**:
- 연락처 매칭 실패 시 이름만 저장

---

### TS-SOC-008: 장례식 방해 금지 모드

**Given** 장례식 경조사 정보가 있고
**And** 현재 시간이 오후 10시일 때
**When** 시스템이 알림을 발송하려고 하면
**Then** 알림을 발송하지 않아야 한다
**And** 다음 날 오전 8시 이후로 연기해야 한다

---

### TS-SOC-009: 관계 히스토리 제안

**Given** 사용자가 지난해 동일 인물의 결혼식에 참여했고
**And** 올해 동일 인물의 생일을 등록하려고 할 때
**When** 시스템이 중복을 감지하면
**Then** 다음 정보를 제안해야 한다:
- "작년 2월에 결혼식에 참여했습니다"
- "지난번 송금 금액: 5만원"

---

### TS-SOC-010: 온디바이스 프라이버시

**Given** 경조사 정보가 저장되었을 때
**When** 네트워크 트래픽을 모니터링하면
**Then** 어떤 외부 서버로도 데이터가 전송되지 않아야 한다
**And** 모든 처리가 온디바이스에서 이루어져야 한다

---

## 품질 게이트 기준

### TRUST 5 준수

| 항목 | 기준 | 검증 방법 |
|------|------|----------|
| Test-First | 85% 이상 커버리지 | Jest coverage report |
| Readable | ESLint 에러 0개 | npm run lint |
| Unified | Prettier 포맷팅 | npm run format:check |
| Secured | 보안 취약점 0개 | OWASP check |
| Trackable | Git 커밋 메시지 규격 | Commit lint |

### 성능 기준

| 메트릭 | 목표 | 측정 방법 |
|--------|------|----------|
| 정보 추출 속도 | <500ms | Date.now() 차이 |
| 캘린더 등록 속도 | <200ms | API call time |
| 일정 목록 로딩 | <300ms | Rendering time |
| 번들 크기 증가 | <500KB | IPA/APK size |

### 사용자 경험 기준

| 항목 | 기준 | 테스트 방법 |
|------|------|----------|
| 추출 정확도 | 80% 이상 | 테스트 데이터셋 |
| UI 반응성 | <16ms/frame | React DevTools Profiler |
| 권한 요구 | 명확한 사유 안내 | Manual testing |
| 오류 메시지 | 친절한 가이드 | Manual testing |

## 완료 정의 (Definition of Done)

### 필수 항목 (Must Have)

- [ ] 모든 EARS 요구사항 구현 완료
- [ ] 인수 테스트 시나리오 100% 통과
- [ ] 테스트 커버리지 85% 이상
- [ ] ESLint 에러 0개
- [ ] TypeScript any 타입 0개
- [ ] 보안 취약점 0개
- [ ] iOS 시뮬레이터 테스트 통과
- [ ] Android 에뮬레이터 테스트 통과
- [ ] 온디바이스 처리 검증 완료

### 권장 항목 (Should Have)

- [ ] E2E 테스트 10개 이상 작성
- [ ] 성능 프로파일링 완료
- [ ] 접근성(a11y) 검사 통과
- [ ] 다크 모드 지원
- [ ] 한국어/영어 다국어 지원

### 선택적 항목 (Nice to Have)

- [ ] 연간 경조사 달력 기능
- [ ] 경조사 통계 리포트
- [ ] 그룹 채팅 감지 기능
- [ ] 교통편 안내 기능

## 검증 방법

### 자동화된 테스트

**Unit Tests**:
```bash
npm run test:unit -- --coverage
# Target: 85% coverage
```

**Integration Tests**:
```bash
npm run test:integration
# Target: All scenarios pass
```

**E2E Tests**:
```bash
npm run test:e2e
# Target: Detox framework, 10+ scenarios
```

### 수동 테스트 체크리스트

**기능 검증**:
- [ ] 스크린샷 캡처 후 정보 추출
- [ ] 채팅 텍스트 복사 후 분석
- [ ] 캘린더에 일정 등록 확인
- [ ] 알림 발송 확인
- [ ] 송금 앱 딥링크 실행

**UI/UX 검증**:
- [ ] 카드 형태 정보 표시
- [ ] 편집 화면 직관성
- [ ] 반응형 레이아웃 (다양한 화면 크기)
- [ ] 다크 모드

**프라이버시 검증**:
- [ ] 연락처 접근 권한 요구
- [ ] 캘린더 권한 요구
- [ ] 네트워크 트래픽 없음 확인

### 보안 감사

**데이터 암호화**:
- [ ] SQLite SQLCipher 활성화
- [ ] 키 체인/키 스토어 활용

**권한 관리**:
- [ ] 최소 권한 원칙 준수
- [ ] 권한 거부 시 대안 제공

**PII 보호**:
- [ ] 민감 정보 로그 미포함
- [ ] 디버깅 시 데이터 마스킹

## 롤아웃 계획

### Phase 1: 알파 테스트 (내부)
- 대상: 개발팀
- 기간: 1주
- 목표: 주요 버그 발견

### Phase 2: 베타 테스트 (친구/가족)
- 대상: 10-20명
- 기간: 2주
- 목표: 사용자 피드백 수집

### Phase 3: 정식 출시
- 대상: 전체 사용자
- 기간: -
- 목표: 안정화

---

**버전**: 1.0.0
**마지막 업데이트**: 2026-01-18
**작성자**: Spec Builder Agent
